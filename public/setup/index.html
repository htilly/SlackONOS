<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SlackONOS Setup</title>
  <link rel="stylesheet" href="/setup/setup.css?v=5.0">
  <style>
    /* Critical CSS - Fallback if external CSS doesn't load */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .wizard-container { width: 100%; max-width: 700px; }
    .wizard {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }
    .page { display: none; padding: 40px; }
    .page.active { display: block; }
    .welcome-content { text-align: center; padding: 40px 20px; }
    .welcome-logo { width: 180px; height: 180px; border-radius: 20px; margin-bottom: 30px; }
    h1 { font-size: 36px; margin-bottom: 12px; }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, #8b5cf6, #a78bfa);
      color: white;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
    }
  </style>
</head>
<body>
  <div class="background-animation">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <div class="wizard-container">
    <div class="wizard">
      <!-- Welcome Page -->
      <div class="page active" id="page-welcome">
        <div class="welcome-content">
          <img src="/setup/SlackONOS.png?v=5.0" alt="SlackONOS" class="welcome-logo">
          <h1>Welcome to SlackONOS</h1>
          <p class="welcome-text">Let's get started with setup</p>
          <button class="btn btn-primary btn-large" id="btn-start">Start</button>
        </div>
      </div>

      <!-- Platform Selection -->
      <div class="page" id="page-platform">
        <div class="page-header">
          <h2>Which platforms do you want to use?</h2>
          <p>Choose Slack, Discord, or both</p>
        </div>
        <div class="page-body">
          <div class="platform-options">
            <div class="platform-card" data-platform="slack">
              <div class="platform-icon">üí¨</div>
              <h3>Slack</h3>
              <p>Socket Mode and bot token</p>
              <div class="check-icon">‚úì</div>
            </div>
            <div class="platform-card" data-platform="discord">
              <div class="platform-icon">üéÆ</div>
              <h3>Discord</h3>
              <p>Bot token and channels</p>
              <div class="check-icon">‚úì</div>
            </div>
            <div class="platform-card" data-platform="both">
              <div class="platform-icon">üöÄ</div>
              <h3>Both</h3>
              <p>Slack and Discord together</p>
              <div class="check-icon">‚úì</div>
            </div>
          </div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-platform">Back</button>
          <button class="btn btn-primary" id="btn-next-platform">Continue</button>
        </div>
      </div>

      <!-- Slack Setup -->
      <div class="page" id="page-slack">
        <div class="page-header">
          <h2>Connect Slack</h2>
          <p>Enter your Slack credentials</p>
        </div>
        <div class="page-body">
          <div class="info-box info-box-help">
            <span class="info-icon">üìñ</span>
            <div>
              <strong>Need help with setup?</strong> See the detailed guide with all steps, permissions and scopes:
              <div class="help-links">
                <a href="https://github.com/htilly/SlackONOS/blob/develop/SLACK.md" target="_blank" class="help-link">
                  <span>üìö</span> Slack Setup Guide
                </a>
                <a href="https://github.com/htilly/SlackONOS" target="_blank" class="help-link">
                  <span>üîó</span> GitHub Repository
                </a>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>App-Level Token <span class="required">*</span></label>
            <input type="text" id="slack-app-token" placeholder="xapp-1-A0..." class="input">
            <small>From Slack app ‚Üí Socket Mode ‚Üí App-Level Tokens</small>
          </div>
          <div class="form-group">
            <label>Bot User OAuth Token <span class="required">*</span></label>
            <input type="text" id="slack-bot-token" placeholder="xoxb-123..." class="input">
            <small>From Slack app ‚Üí Install App ‚Üí Bot User OAuth Token</small>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Admin Channel</label>
              <input type="text" id="admin-channel" value="music-admin" class="input">
            </div>
            <div class="form-group">
              <label>Standard Channel</label>
              <input type="text" id="standard-channel" value="music" class="input">
            </div>
          </div>
          <div id="slack-validation" class="validation-message"></div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-slack">Back</button>
          <div class="footer-right">
            <button class="btn btn-ghost" id="btn-validate-slack">Validate</button>
            <button class="btn btn-primary" id="btn-next-slack">Next</button>
          </div>
        </div>
      </div>

      <!-- Discord Setup -->
      <div class="page" id="page-discord">
        <div class="page-header">
          <h2>Connect Discord</h2>
          <p>Optional step - you can skip this</p>
        </div>
        <div class="page-body">
          <div class="info-box info-box-success">
            <span class="info-icon">‚ú®</span>
            <div>This step is optional. You can add Discord later.</div>
          </div>
          <div class="info-box info-box-help">
            <span class="info-icon">üìñ</span>
            <div>
              <strong>Need help with setup?</strong> See the detailed guide with all steps, permissions and scopes:
              <div class="help-links">
                <a href="https://github.com/htilly/SlackONOS/blob/develop/DISCORD.md" target="_blank" class="help-link">
                  <span>üìö</span> Discord Setup Guide
                </a>
                <a href="https://github.com/htilly/SlackONOS" target="_blank" class="help-link">
                  <span>üîó</span> GitHub Repository
                </a>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>Discord Bot Token</label>
            <input type="text" id="discord-token" placeholder="MTIzNDU2..." class="input">
            <small>From discord.com/developers ‚Üí Your application ‚Üí Bot</small>
          </div>
          <div class="form-group">
            <label>Channel IDs (comma-separated)</label>
            <input type="text" id="discord-channels" placeholder="123456789, 987654321" class="input">
          </div>
          <div class="form-group">
            <label>Admin Role Names (comma-separated)</label>
            <input type="text" id="discord-admin-roles" placeholder="DJ, Music Admin" class="input">
          </div>
          <div id="discord-validation" class="validation-message"></div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-discord">Back</button>
          <div class="footer-right">
            <button class="btn btn-ghost" id="btn-skip-discord">Skip</button>
            <button class="btn btn-ghost" id="btn-validate-discord">Validate</button>
            <button class="btn btn-primary" id="btn-next-discord">Next</button>
          </div>
        </div>
      </div>

      <!-- Sonos Setup -->
      <div class="page" id="page-sonos">
        <div class="page-header">
          <h2>Connect Sonos</h2>
          <p>Discover or enter your Sonos speaker</p>
        </div>
        <div class="page-body">
          <button class="btn btn-secondary btn-block" id="btn-discover-sonos">
            <span class="btn-icon">üîç</span> Discover Sonos Devices
          </button>
          <div id="sonos-devices" class="device-list"></div>
          <div id="sonos-error" class="validation-message"></div>
          <div class="divider">
            <span>eller</span>
          </div>
          <div class="form-group">
            <label>Sonos IP Address <span class="required">*</span></label>
            <input type="text" id="sonos-ip" placeholder="192.168.1.100" class="input">
            <small>From Sonos app ‚Üí Settings ‚Üí System ‚Üí About My System</small>
          </div>
          <div id="sonos-validation" class="validation-message"></div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-sonos">Back</button>
          <div class="footer-right">
            <button class="btn btn-ghost" id="btn-validate-sonos">Validate</button>
            <button class="btn btn-primary" id="btn-next-sonos">Next</button>
          </div>
        </div>
      </div>

      <!-- Spotify Setup -->
      <div class="page" id="page-spotify">
        <div class="page-header">
          <h2>Connect Spotify</h2>
          <p>Enter your Spotify developer credentials</p>
        </div>
        <div class="page-body">
          <div class="info-box">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <div>
              <strong>Missing credentials?</strong> Create an app at
              <a href="https://developer.spotify.com/dashboard" target="_blank">developer.spotify.com</a>
            </div>
          </div>
          <div class="form-group">
            <label>Client ID <span class="required">*</span></label>
            <input type="text" id="spotify-client-id" placeholder="abc123..." class="input">
          </div>
          <div class="form-group">
            <label>Client Secret <span class="required">*</span></label>
            <input type="password" id="spotify-client-secret" placeholder="def456..." class="input">
          </div>
          <div class="form-group">
            <label>Market/Country</label>
            <select id="spotify-market" class="input">
              <option value="US">United States (US)</option>
              <option value="SE">Sweden (SE)</option>
              <option value="GB">United Kingdom (GB)</option>
              <option value="DE">Germany (DE)</option>
              <option value="FR">France (FR)</option>
              <option value="CA">Canada (CA)</option>
              <option value="AU">Australia (AU)</option>
              <option value="JP">Japan (JP)</option>
            </select>
          </div>
          <div id="spotify-validation" class="validation-message"></div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-spotify">Back</button>
          <div class="footer-right">
            <button class="btn btn-ghost" id="btn-validate-spotify">Validate</button>
            <button class="btn btn-primary" id="btn-finish">Finish</button>
          </div>
        </div>
      </div>

      <!-- Password Setup Page -->
      <div class="page" id="page-password">
        <div class="page-header">
          <h2>Set Up Authentication</h2>
          <p id="password-page-description">Choose your preferred authentication method</p>
        </div>
        <div class="page-body">
          <div class="info-box info-box-warning" id="password-required-notice" style="display: none;">
            <span class="info-icon">‚ö†Ô∏è</span>
            <div>
              <strong>Authentication Required:</strong> You must set up at least one authentication method before continuing with setup.
            </div>
          </div>
          
          <!-- Yubikey Enrollment Section (Preferred) -->
          <div id="yubikey-section" style="margin-bottom: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(8, 145, 178, 0.1)); border: 2px solid rgba(6, 182, 212, 0.3); border-radius: 12px;">
            <div style="text-align: center; margin-bottom: 1rem;">
              <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üîê</div>
              <h3 style="margin: 0 0 0.5rem 0; color: #06b6d4;">Recommended: Enroll Yubikey</h3>
              <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; margin: 0;">
                Use a FIDO2 security key for passwordless authentication
              </p>
            </div>
            <button class="btn btn-primary" id="btn-enroll-yubikey" style="width: 100%; background: linear-gradient(135deg, #06b6d4, #0891b2); font-size: 1.1rem; padding: 1rem;">
              üîê Enroll Yubikey
            </button>
            <div id="yubikey-message" class="validation-message" style="margin-top: 1rem;"></div>
          </div>
          
          <!-- Divider -->
          <div style="text-align: center; margin: 2rem 0; position: relative;">
            <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: rgba(255, 255, 255, 0.1);"></div>
            <span style="background: rgba(15, 23, 42, 0.8); padding: 0 1rem; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">Or set a password</span>
          </div>
          
          <!-- Password Section -->
          <div id="password-form-section">
            <div class="info-box info-box-warning" id="password-optional-notice">
              <span class="info-icon">üîí</span>
              <div>
                <strong>Security Notice:</strong> This password will be required to access the setup wizard and admin panel after initial setup is complete.
              </div>
            </div>
            <div class="form-group">
              <label>Password <span class="required" id="password-required-indicator">*</span></label>
              <input type="password" id="password" placeholder="Enter password (min 8 characters)" class="input">
              <small>Minimum 8 characters</small>
            </div>
            <div class="form-group">
              <label>Confirm Password <span class="required" id="password-confirm-required-indicator">*</span></label>
              <input type="password" id="password-confirm" placeholder="Confirm password" class="input">
            </div>
            <div id="password-validation" class="validation-message"></div>
          </div>
        </div>
        <div class="page-footer">
          <button class="btn btn-secondary" id="btn-back-password">Back</button>
          <button class="btn btn-primary" id="btn-next-password">Continue</button>
        </div>
      </div>

      <!-- Success Page -->
      <div class="page" id="page-success">
        <div class="success-content">
          <div class="success-icon">üéâ</div>
          <h1>All Done!</h1>
          <p class="success-text">Your SlackONOS bot is now configured</p>
          <div class="success-steps">
            <div class="success-step">
              <span class="step-num">1</span>
              <span>Restart SlackONOS</span>
            </div>
            <div class="success-step">
              <span class="step-num">2</span>
              <span>Invite the bot to your channels</span>
            </div>
            <div class="success-step">
              <span class="step-num">3</span>
              <span>Start playing music!</span>
            </div>
          </div>
          <div class="success-buttons">
            <button class="btn btn-primary btn-large" id="btn-restart">Restart App</button>
            <button class="btn btn-secondary btn-large" id="btn-admin" onclick="window.location.href='/admin'">Admin</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@simplewebauthn/browser@9.0.0/dist/bundle/index.umd.min.js"></script>
  <script src="/setup/webauthn-client.js"></script>
  <script src="/setup/setup.js?v=5.0"></script>
</body>
</html>
